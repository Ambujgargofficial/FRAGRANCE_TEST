<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Scent Soul - Fragrance Finder</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <style>
        body { font-family: 'Outfit', sans-serif; -webkit-tap-highlight-color: transparent; }
        h1, h2, h3, .serif-font { font-family: 'Playfair Display', serif; }

        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .animate-fade-in { animation: fadeIn 0.6s ease-out forwards; }
        
        @keyframes floatCard { 0% { transform: translateY(0px); } 100% { transform: translateY(-10px); } }
        .animate-float { animation: floatCard 6s ease-in-out infinite alternate; }

        /* Sassy Gradient */
        .sassy-bg {
            background: linear-gradient(120deg, #fdf4ff 0%, #fae8ff 25%, #f0abfc 50%, #e879f9 75%, #d946ef 100%);
            background-size: 200% 200%;
            animation: gradientBG 15s ease infinite;
        }
        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        /* Blobs */
        .blob { position: absolute; border-radius: 50%; filter: blur(60px); opacity: 0.6; animation: floatBlob 10s infinite alternate; z-index: 0; }
        @keyframes floatBlob { 0% { transform: translate(0, 0) scale(1); } 100% { transform: translate(20px, -20px) scale(1.1); } }

        /* Range Slider */
        input[type=range] { -webkit-appearance: none; width: 100%; background: transparent; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 36px; width: 36px; border-radius: 50%; background: #fff; border: 6px solid currentColor; margin-top: -14px; box-shadow: 0 4px 10px rgba(0,0,0,0.15); transition: transform 0.1s; }
        input[type=range]::-webkit-slider-thumb:hover { transform: scale(1.2); }
        input[type=range]::-webkit-slider-runnable-track { width: 100%; height: 10px; border-radius: 999px; }
        
        /* Option Button */
        .option-btn { transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        .option-btn:active { transform: scale(0.98); }
        .option-btn.active { background: linear-gradient(135deg, #faf5ff 0%, #f3e8ff 100%); border-color: #9333ea; color: #6b21a8; box-shadow: 0 4px 12px rgba(147, 51, 234, 0.2); }

        /* Mobile Safe Area */
        .safe-bottom { padding-bottom: env(safe-area-inset-bottom); }
        
        /* Custom Scrollbar */
        .custom-scrollbar::-webkit-scrollbar { width: 6px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #f1f1f1; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #c084fc; border-radius: 10px; }
    </style>
</head>
<body class="sassy-bg h-[100dvh] overflow-hidden text-slate-800 relative">

    <!-- Background Blobs -->
    <div class="blob bg-purple-300 w-96 h-96 top-[-10%] left-[-10%] mix-blend-multiply pointer-events-none"></div>
    <div class="blob bg-pink-300 w-96 h-96 top-[20%] right-[-10%] mix-blend-multiply pointer-events-none" style="animation-delay: 2s"></div>
    
    <div id="root" class="h-full w-full relative z-10"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect } = React;

        // --- âš ï¸ IMPORTANT: PASTE YOUR GOOGLE SCRIPT URL HERE âš ï¸ ---
        const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxb0sNDoHS25JKXOIKHNoJ2zhxPEjRtBGSeseBRro8h0AkmJevVxWehQp8qGahXW5ZgUw/exec"; 

        // --- ICONS ---
        // Using simple SVG components to avoid runtime dependency issues
        const Icons = {
            Wind: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M17.7 7.7a2.5 2.5 0 1 1 1.8 4.3H2"/><path d="M9.6 4.6A2 2 0 1 1 11 8H2"/><path d="M12.6 19.4A2 2 0 1 0 14 16H2"/></svg>,
            Zap: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>,
            Brain: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/></svg>,
            Trees: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M10 10v.2A3 3 0 0 1 8.9 16v0H5v0h0a3 3 0 0 1-1-5.8V10a3 3 0 0 1 5.3-2.1"/><path d="M7 16v6"/><path d="M13 19v3"/><path d="M12 19h8.3a1 1 0 0 0 .7-1.7L18 14h.3a1 1 0 0 0 .7-1.7L16 9h.2a1 1 0 0 0 .6-1.7L13 2.6a1 1 0 0 0-1.7 0L8.3 7.3a1 1 0 0 0 .6 1.7H9.1a1 1 0 0 0 .7 1.7L7 14h.4a1 1 0 0 0 .7 1.7L11 19z"/></svg>,
            Heart: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>,
            Sparkles: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/><path d="M5 3v4"/><path d="M9 3v4"/><path d="M3 5h4"/><path d="M3 9h4"/></svg>,
            Activity: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 12h-4l-3 9L9 3l-3 9H2"/></svg>,
            RefreshCw: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8"/><path d="M21 3v5h-5"/><path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16"/><path d="M3 21v-5h5"/></svg>,
            ArrowRight: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M5 12h14"/><path d="m12 5 7 7-7 7"/></svg>,
            Sun: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></svg>,
            User: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>,
            Phone: (props) => <svg {...props} xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
        };

        // --- DATABASE ---
        const FRAGRANCE_DB = [
            { id: 1, name: "Tranquil Sleep", primaryNeed: "SI", secondaryNeed: "SEI", triggers: { SI: 9, EI: 2, FI: 0, EnI: 0, SEI: 8 }, description: "Deep relaxation for poor sleep and high stress.", moods: ["Relaxation", "Anxiety Relief", "Insomnia Aid"], iconComponent: Icons.Wind, image: "https://images.unsplash.com/photo-1519681393798-38e363ba115e?auto=format&fit=crop&w=800&q=80" },
            { id: 2, name: "Morning Vitality", primaryNeed: "EI", secondaryNeed: "SI", triggers: { SI: 3, EI: 9, FI: 5, EnI: 0, SEI: 0 }, description: "Gentle awakening for morning fatigue and low energy.", moods: ["Gentle Awakening", "Mood Uplift", "Energy Boost"], iconComponent: Icons.Zap, image: "https://images.unsplash.com/photo-1620916297397-a4a5402a3c6c?auto=format&fit=crop&w=800&q=80" },
            { id: 3, name: "Focus Flow", primaryNeed: "FI", secondaryNeed: "SI", triggers: { SI: 5, EI: 5, FI: 9, EnI: 0, SEI: 0 }, description: "Enhances concentration and mental clarity for desk work.", moods: ["High Focus", "Mental Clarity", "Concentration"], iconComponent: Icons.Brain, image: "https://images.unsplash.com/photo-1497032628192-86f99bcd76bc?auto=format&fit=crop&w=800&q=80" },
            { id: 4, name: "Emotional Balance", primaryNeed: "SEI", secondaryNeed: "SI", triggers: { SI: 6, EI: 5, FI: 0, EnI: 0, SEI: 9 }, description: "Grounding and stability for emotional swings.", moods: ["Inner Stability", "Grounding", "Calm"], iconComponent: Icons.Heart, image: "https://images.unsplash.com/photo-1545241047-6083a3684587?auto=format&fit=crop&w=800&q=80" },
            { id: 5, name: "Calm Confidence", primaryNeed: "SI", secondaryNeed: "FI", triggers: { SI: 8, EI: 6, FI: 7, EnI: 0, SEI: 4 }, description: "Boosts presence and reduces anxiety during high interaction.", moods: ["Confidence", "Presence", "Networking"], iconComponent: Icons.Sparkles, image: "https://images.unsplash.com/photo-1595341388084-77a8f77732dc?auto=format&fit=crop&w=800&q=80" },
            { id: 6, name: "Digital Detox", primaryNeed: "EnI", secondaryNeed: "SI", triggers: { SI: 6, EI: 4, FI: 0, EnI: 9, SEI: 5 }, description: "Eye relief and sensory relaxation for high screen users.", moods: ["Eye Relief", "Senses Relaxation", "Unplugging"], iconComponent: Icons.Activity, image: "https://images.unsplash.com/photo-1441974231531-c6227db76b6e?auto=format&fit=crop&w=800&q=80" },
            { id: 7, name: "Urban Shield", primaryNeed: "EnI", secondaryNeed: "EI", triggers: { SI: 5, EI: 5, FI: 0, EnI: 10, SEI: 2 }, description: "Refreshing and cleansing against harsh environments.", moods: ["Refreshing", "Cleansing", "Protection"], iconComponent: Icons.Trees, image: "https://images.unsplash.com/photo-1514565131-fce0801e5785?auto=format&fit=crop&w=800&q=80" },
            { id: 8, name: "Meditative Stillness", primaryNeed: "SI", secondaryNeed: "SEI", triggers: { SI: 8, EI: 3, FI: 6, EnI: 0, SEI: 7 }, description: "Deep calm for introspection and mindfulness.", moods: ["Deep Calm", "Introspection", "Mindfulness"], iconComponent: Icons.Wind, image: "https://images.unsplash.com/photo-1528319725582-ddc096101511?auto=format&fit=crop&w=800&q=80" },
            { id: 9, name: "Fresh Optimism", primaryNeed: "EI", secondaryNeed: "SEI", triggers: { SI: 4, EI: 8, FI: 0, EnI: 0, SEI: 7 }, description: "Uplifts low mood and emotional flatness.", moods: ["Emotional Uplift", "Motivation", "Joy"], iconComponent: Icons.Zap, image: "https://images.unsplash.com/photo-1470770903676-69b98201ea1c?auto=format&fit=crop&w=800&q=80" },
            { id: 10, name: "Warm Comfort", primaryNeed: "SEI", secondaryNeed: "SI", triggers: { SI: 7, EI: 2, FI: 0, EnI: 0, SEI: 10 }, description: "Safe, nurturing relaxation for emotional fatigue.", moods: ["Security", "Nurturing", "Relaxation"], iconComponent: Icons.Heart, image: "https://images.unsplash.com/photo-1513558161293-cdaf765ed2fd?auto=format&fit=crop&w=800&q=80" },
            { id: 11, name: "Creative Spark", primaryNeed: "FI", secondaryNeed: "EI", triggers: { SI: 2, EI: 7, FI: 10, EnI: 0, SEI: 6 }, description: "Unlocks imagination and flows through creative blocks.", moods: ["Inspiration", "Imagination Flow", "Creativity"], iconComponent: Icons.Brain, image: "https://images.unsplash.com/photo-1501472312651-726afe119ff1?auto=format&fit=crop&w=800&q=80" },
            { id: 12, name: "Balanced Everyday", primaryNeed: "BAL", secondaryNeed: "BAL", triggers: { SI: 5, EI: 5, FI: 5, EnI: 5, SEI: 5 }, description: "A neutral, stable fragrance for general lifestyle.", moods: ["Stability", "Neutral", "Daily Wear"], iconComponent: Icons.RefreshCw, image: "https://images.unsplash.com/photo-1594035910387-fea477942698?auto=format&fit=crop&w=800&q=80" }
        ];

        const INDEX_FULL_NAMES = { SI: "Stress", EI: "Energy", FI: "Focus", EnI: "Environment", SEI: "Sensitivity", BAL: "Balance" };

        // --- QUESTIONS ---
        const QUESTIONS_DB = [
            // STRESS
            { id: "si1", indexKey: "SI", icon: Icons.Wind, text: "How frequently do you feel mentally overwhelmed?", type: "options", options: [{ label: "Rarely", value: 1 }, { label: "Occasionally", value: 4 }, { label: "Often", value: 7 }, { label: "Daily", value: 10 }] },
            { id: "si2", indexKey: "SI", icon: Icons.Wind, text: "At day's end, describe your state of mind:", type: "options", options: [{ label: "Calm", value: 2 }, { label: "Tense", value: 5 }, { label: "Exhausted", value: 8 }, { label: "Anxious", value: 10 }] },
            { id: "si3", indexKey: "SI", icon: Icons.Wind, text: "How many hours do you usually sleep?", type: "options", options: [{ label: "8+ Hours", value: 1 }, { label: "6-7 Hours", value: 4 }, { label: "5-6 Hours", value: 7 }, { label: "< 5 Hours", value: 10 }] },
            { id: "si4", indexKey: "SI", icon: Icons.Wind, text: "Rate your mental noise level (1-10)", type: "slider", minLabel: "Silent", maxLabel: "Chaos" },
            // ENERGY
            { id: "ei1", indexKey: "EI", icon: Icons.Zap, text: "How energized do you feel usually?", type: "options", options: [{ label: "Very High", value: 1 }, { label: "Moderate", value: 4 }, { label: "Low", value: 7 }, { label: "Drained", value: 10 }] },
            { id: "ei2", indexKey: "EI", icon: Icons.Zap, text: "Your physical activity level?", type: "options", options: [{ label: "High", value: 1 }, { label: "Moderate", value: 4 }, { label: "Light", value: 7 }, { label: "Sedentary", value: 10 }] },
            { id: "ei3", indexKey: "EI", icon: Icons.Zap, text: "Caffeine consumption per day?", type: "options", options: [{ label: "None", value: 1 }, { label: "1-2 Cups", value: 4 }, { label: "3-4 Cups", value: 7 }, { label: "4+ Cups", value: 10 }] },
            { id: "ei4", indexKey: "EI", icon: Icons.Zap, text: "Rate your physical fatigue (1-10)", type: "slider", minLabel: "Active", maxLabel: "Drained" },
            // FOCUS
            { id: "fi1", indexKey: "FI", icon: Icons.Brain, text: "Distraction level while working?", type: "options", options: [{ label: "Focused", value: 1 }, { label: "Moderate", value: 5 }, { label: "Easy", value: 8 }, { label: "Very Easy", value: 10 }] },
            { id: "fi2", indexKey: "FI", icon: Icons.Brain, text: "Daily screen exposure:", type: "options", options: [{ label: "<3 Hours", value: 2 }, { label: "3-6 Hours", value: 5 }, { label: "6-10 Hrs", value: 8 }, { label: "10+ Hrs", value: 10 }] },
            { id: "fi3", indexKey: "FI", icon: Icons.Brain, text: "Work social interaction level?", type: "options", options: [{ label: "Very High", value: 8 }, { label: "Moderate", value: 5 }, { label: "Low", value: 4 }, { label: "Isolated", value: 10 }] },
            { id: "fi4", indexKey: "FI", icon: Icons.Brain, text: "Nature of mental workload?", type: "options", options: [{ label: "Relaxed", value: 1 }, { label: "Steady", value: 4 }, { label: "Demanding", value: 7 }, { label: "Intense", value: 10 }] },
            // ENVIRONMENT
            { id: "eni1", indexKey: "EnI", icon: Icons.Trees, text: "Primary work environment?", type: "options", options: [{ label: "Indoor AC", value: 2 }, { label: "Home", value: 4 }, { label: "Mixed", value: 7 }, { label: "Outdoor", value: 10 }] },
            { id: "eni2", indexKey: "EnI", icon: Icons.Trees, text: "City pollution exposure (1-10)", type: "slider", minLabel: "Low", maxLabel: "High" },
            { id: "eni3", indexKey: "EnI", icon: Icons.Sun, text: "What is your city's weather like?", type: "options", options: [{ label: "Pleasant", value: 3 }, { label: "Cold", value: 5 }, { label: "Hot", value: 8 }, { label: "Variable", value: 10 }] },
            { id: "eni4", indexKey: "EnI", icon: Icons.Trees, text: "City type you live in?", type: "options", options: [{ label: "Rural", value: 2 }, { label: "Town", value: 5 }, { label: "City", value: 8 }, { label: "Metro", value: 10 }] },
            // SENSITIVITY
            { id: "sei1", indexKey: "SEI", icon: Icons.Heart, text: "Personality type?", type: "options", options: [{ label: "Calm", value: 2 }, { label: "Balanced", value: 5 }, { label: "Expressive", value: 7 }, { label: "Intense", value: 10 }] },
            { id: "sei2", indexKey: "SEI", icon: Icons.Heart, text: "Reaction to strong scents?", type: "options", options: [{ label: "Love it", value: 1 }, { label: "Okay", value: 4 }, { label: "Prefer Mild", value: 7 }, { label: "Hate it", value: 10 }] },
            { id: "sei3", indexKey: "SEI", icon: Icons.Heart, text: "Preferred scent vibe?", type: "options", options: [{ label: "Fresh", value: 2 }, { label: "Warm", value: 5 }, { label: "Earthy", value: 7 }, { label: "Bold", value: 10 }] },
            { id: "sei4", indexKey: "SEI", icon: Icons.Heart, text: "Emotional sensitivity today (1-10)", type: "slider", minLabel: "Resilient", maxLabel: "Sensitive" }
        ];

        // --- COMPONENTS ---
        const ProgressBar = ({ current, total }) => (
            <div className="w-full bg-white/50 h-2 fixed top-0 left-0 z-50">
                <div className="bg-gradient-to-r from-purple-500 to-pink-500 h-full transition-all duration-700 ease-out" style={{ width: `${(current / total) * 100}%` }}></div>
            </div>
        );

        // Separate Component to avoid re-rendering issues and scoping problems
        const QuestionCard = ({ question, answer, onAnswer }) => {
            const Icon = question.icon;
            const sliderColor = answer > 7 ? '#db2777' : answer > 4 ? '#9333ea' : '#4f46e5';

            return (
                <div className="bg-white/80 backdrop-blur-xl p-6 md:p-10 rounded-3xl shadow-lg border border-white/60 w-full animate-fade-in flex flex-col justify-center min-h-[auto] md:min-h-[400px]">
                    <div className="flex items-center gap-3 md:gap-4 mb-4 md:mb-8 justify-center">
                        <div className="p-3 md:p-4 bg-fuchsia-50 text-fuchsia-600 rounded-2xl shadow-inner">
                            <Icon className="w-6 h-6 md:w-8 md:h-8" />
                        </div>
                        <span className="text-sm md:text-base font-bold tracking-widest text-fuchsia-500 uppercase">{INDEX_FULL_NAMES[question.indexKey]} Index</span>
                    </div>
                    
                    <h3 className="text-2xl md:text-5xl font-bold text-slate-800 mb-6 md:mb-12 leading-snug text-center">{question.text}</h3>

                    {question.type === 'options' ? (
                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-6 w-full max-w-2xl mx-auto">
                            {question.options.map((opt) => (
                                <button
                                    key={opt.label}
                                    onClick={() => onAnswer(question.id, opt.value)}
                                    className={`option-btn py-4 md:py-6 px-4 md:px-6 rounded-xl md:rounded-2xl text-lg md:text-2xl font-medium border-2 flex items-center justify-center text-center w-full ${
                                        answer === opt.value 
                                        ? 'active' 
                                        : 'border-transparent bg-white/60 text-gray-500 hover:bg-white hover:border-purple-100'
                                    }`}
                                >
                                    {opt.label}
                                </button>
                            ))}
                        </div>
                    ) : (
                        <div className="px-2 md:px-6 py-4 md:py-8 w-full max-w-2xl mx-auto">
                            <div className="flex justify-between text-sm md:text-lg font-bold text-gray-400 mb-4 md:mb-8 uppercase tracking-wider">
                                <span>{question.minLabel}</span>
                                <span>{question.maxLabel}</span>
                            </div>
                            <input 
                                type="range" min="1" max="10" 
                                value={answer || 5} 
                                onChange={(e) => onAnswer(question.id, parseInt(e.target.value))}
                                style={{ color: sliderColor, background: `linear-gradient(90deg, ${sliderColor} 0%, ${sliderColor} ${(answer||5)*10}%, #e2e8f0 ${(answer||5)*10}%)` }}
                            />
                            <div className="text-center mt-6 md:mt-10 text-4xl md:text-6xl font-bold transition-colors duration-300" style={{ color: sliderColor }}>
                                {answer || 5}
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- MAIN APP ---
        function App() {
            const [step, setStep] = useState(0); 
            const [introStep, setIntroStep] = useState(0); // 0: Name, 1: Ask Phone Consent, 2: Phone Input
            const [userData, setUserData] = useState({ name: '', phone: '' });
            const [answers, setAnswers] = useState({});
            const [result, setResult] = useState(null);
            const [finalScores, setFinalScores] = useState(null);
            const [validationMsg, setValidationMsg] = useState("");

            const totalQuestions = QUESTIONS_DB.length;

            const handleNameSubmit = () => {
                if (!userData.name.trim()) {
                    setValidationMsg("Please enter your name to begin âœ¨");
                    return;
                }
                setValidationMsg("");
                setIntroStep(1); 
            };

            const handleConsent = (agreed) => {
                if (agreed) {
                    setIntroStep(2); 
                } else {
                    setValidationMsg(`Dear ${userData.name}, we respect your privacy!`);
                    setTimeout(() => {
                        setValidationMsg("");
                        setStep(1); 
                    }, 1500);
                }
            };

            const handlePhoneSubmit = () => {
                if (userData.phone.length !== 10) {
                    setValidationMsg("Please enter a valid 10-digit number.");
                    return;
                }
                setValidationMsg("Thank You !! for sharing your number");
                setTimeout(() => {
                    setValidationMsg("");
                    setStep(1); 
                }, 1500);
            };

            const handleAnswer = (qId, val) => {
                setAnswers(prev => ({ ...prev, [qId]: val }));
            };

            const submitDataToSheet = (finalResult, scores) => {
                if (!GOOGLE_SCRIPT_URL) return; 
                const data = {
                    name: userData.name,
                    phone: userData.phone || "Not Provided",
                    perfumeName: finalResult.name,
                    primaryNeed: INDEX_FULL_NAMES[finalResult.primaryNeed],
                    scores: scores
                };
                fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                }).catch(err => console.error(err));
            };

            const calculateResult = () => {
                const scores = { SI: 0, EI: 0, FI: 0, EnI: 0, SEI: 0 };
                const counts = { SI: 0, EI: 0, FI: 0, EnI: 0, SEI: 0 };

                QUESTIONS_DB.forEach(q => {
                    if (answers[q.id]) {
                        scores[q.indexKey] += answers[q.id];
                        counts[q.indexKey]++;
                    }
                });

                Object.keys(scores).forEach(k => {
                    if (counts[k] > 0) scores[k] = Math.round(scores[k] / counts[k]);
                });

                setFinalScores(scores);

                const entries = Object.entries(scores);
                entries.sort((a, b) => b[1] - a[1]); 
                const dominantIndex = entries[0][0];
                const dominantScore = entries[0][1];

                let match = null;

                if (dominantScore > 6) {
                    let candidates = FRAGRANCE_DB.filter(f => f.primaryNeed === dominantIndex);
                    if (candidates.length > 0) {
                        const scoredCandidates = candidates.map(f => {
                            let diff = 0;
                            Object.keys(scores).forEach(k => diff += Math.abs(scores[k] - f.triggers[k]));
                            return { ...f, diff };
                        });
                        scoredCandidates.sort((a, b) => a.diff - b.diff);
                        match = scoredCandidates[0];
                    }
                }

                if (!match) {
                    const isBalanced = entries.every(([k, v]) => v >= 4 && v <= 6);
                    if (isBalanced) {
                        match = FRAGRANCE_DB.find(f => f.name === "Balanced Everyday");
                    } else {
                        const scored = FRAGRANCE_DB.map(f => {
                            let diff = 0;
                            Object.keys(scores).forEach(k => diff += Math.abs(scores[k] - f.triggers[k]));
                            return { ...f, diff };
                        });
                        scored.sort((a, b) => a.diff - b.diff);
                        match = scored[0];
                    }
                }

                setResult(match);
                submitDataToSheet(match, scores); 
                setStep(totalQuestions + 1);
            };

            const currentQuestion = useMemo(() => {
                if (step === 0 || step > totalQuestions) return null;
                return QUESTIONS_DB[step - 1];
            }, [step]);

            const canProceed = currentQuestion ? answers[currentQuestion.id] !== undefined : false;

            return (
                <div className="h-[100dvh] w-full flex flex-col overflow-hidden bg-fuchsia-50">
                    {step > 0 && step <= totalQuestions && <ProgressBar current={step} total={totalQuestions} />}

                    {/* INTRO */}
                    {step === 0 && (
                        <div className="h-full w-full flex flex-col items-center justify-center p-6 text-center animate-fade-in relative overflow-hidden">
                            <div className="absolute inset-0 sassy-bg opacity-90"></div>
                            <div className="bg-white/60 backdrop-blur-xl p-8 md:p-12 rounded-[2.5rem] shadow-2xl border border-white/50 max-w-lg w-full relative z-10 mx-4">
                                <div className="w-24 h-24 bg-white rounded-full shadow-xl flex items-center justify-center mb-8 mx-auto animate-bounce ring-4 ring-purple-200">
                                    <Icons.Sparkles className="w-10 h-10 text-fuchsia-600" />
                                </div>
                                <h1 className="text-5xl md:text-7xl font-black mb-4 text-slate-900 serif-font tracking-tight">Scent Soul</h1>
                                
                                {introStep === 0 && (
                                    <>
                                        <p className="text-xl text-slate-700 font-medium mb-8">What can we call you?</p>
                                        <div className="mb-6 relative">
                                            <div className="absolute top-4 left-4 text-purple-400"><Icons.User className="w-5 h-5"/></div>
                                            <input type="text" placeholder="Enter your name" value={userData.name} onChange={(e) => setUserData({...userData, name: e.target.value})} className="w-full pl-12 pr-4 py-4 rounded-xl bg-white border-2 border-purple-100 focus:border-purple-500 focus:outline-none text-lg font-medium shadow-sm" />
                                        </div>
                                        <button onClick={handleNameSubmit} className="w-full bg-slate-900 text-white py-4 rounded-xl text-xl font-bold shadow-xl flex items-center justify-center gap-2">Next <Icons.ArrowRight className="w-5 h-5" /></button>
                                    </>
                                )}

                                {introStep === 1 && (
                                    <>
                                        <h2 className="text-2xl font-bold text-slate-800 mb-4">Dear {userData.name},</h2>
                                        <p className="text-lg text-slate-600 mb-8">Do you want to share your phone number for exclusive offers?</p>
                                        <div className="flex flex-col gap-3">
                                            <button onClick={() => handleConsent(true)} className="w-full bg-purple-600 text-white py-3 rounded-xl font-bold shadow-lg">Yes, sure!</button>
                                            <button onClick={() => handleConsent(false)} className="w-full bg-white text-gray-500 py-3 rounded-xl font-bold shadow border border-gray-200">No, maybe later</button>
                                        </div>
                                    </>
                                )}

                                {introStep === 2 && (
                                    <>
                                        <p className="text-xl text-slate-700 font-medium mb-6">Please enter your number</p>
                                        <div className="mb-6 relative">
                                            <div className="absolute top-4 left-4 text-purple-400"><Icons.Phone className="w-5 h-5"/></div>
                                            <input type="tel" placeholder="10-digit number" maxLength="10" value={userData.phone} onChange={(e) => setUserData({...userData, phone: e.target.value.replace(/\D/g,'')})} className="w-full pl-12 pr-4 py-4 rounded-xl bg-white border-2 border-purple-100 focus:border-purple-500 focus:outline-none text-lg font-medium shadow-sm" />
                                        </div>
                                        <button onClick={handlePhoneSubmit} className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl text-lg font-bold shadow-lg">Submit & Start ðŸš€</button>
                                    </>
                                )}

                                {validationMsg && <div className="mt-4 text-sm font-bold text-pink-600 animate-pulse bg-pink-50 py-2 rounded-lg">{validationMsg}</div>}
                            </div>
                        </div>
                    )}

                    {/* QUESTIONS */}
                    {step > 0 && step <= totalQuestions && currentQuestion && (
                        <div className="h-full w-full flex flex-col relative overflow-hidden">
                            <div className="absolute inset-0 bg-gradient-to-br from-purple-50 via-pink-50 to-white -z-10"></div>
                            <div className="flex-1 overflow-y-auto p-6 flex flex-col items-center justify-center pb-32">
                                <QuestionCard 
                                    key={currentQuestion.id} 
                                    question={currentQuestion} 
                                    answer={answers[currentQuestion.id]} 
                                    onAnswer={handleAnswer} 
                                />
                            </div>
                            <div className="absolute bottom-0 left-0 w-full bg-white/90 backdrop-blur-lg border-t border-white/60 p-4 safe-bottom z-50 shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
                                <div className="max-w-xl mx-auto grid grid-cols-3 items-center">
                                    <div className="text-left">
                                        <button onClick={() => setStep(s => s - 1)} className="text-gray-400 font-bold hover:text-slate-800 px-4 py-3 transition-colors">Back</button>
                                    </div>
                                    <div className="text-center">
                                        <button onClick={() => step === totalQuestions ? calculateResult() : setStep(s => s + 1)} disabled={!canProceed} className={`px-10 py-3 rounded-full font-bold text-lg shadow-lg transition-all flex items-center gap-2 mx-auto ${canProceed ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white active:scale-95' : 'bg-gray-200 text-gray-400 cursor-not-allowed'}`}>
                                            {step === totalQuestions ? "Reveal" : "Next"} <Icons.ArrowRight className="w-5 h-5" />
                                        </button>
                                    </div>
                                    <div></div>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* RESULT SCREEN - GLASS CARD RESTORED */}
                    {step > totalQuestions && result && (
                        <div className="h-full w-full flex flex-col md:flex-row overflow-hidden animate-fade-in bg-white">
                            {/* Left Side: GLASS CARD OVER IMAGE */}
                            <div className="md:w-5/12 h-[45vh] md:h-full relative overflow-hidden flex items-center justify-center bg-gray-900 group shrink-0">
                                {/* Background Image */}
                                <div className="absolute inset-0 bg-cover bg-center transition-transform duration-[10s] hover:scale-110" style={{ backgroundImage: `url('${result.image}')` }}></div>
                                <div className="absolute inset-0 bg-black/40"></div>
                                
                                {/* The Glass Card */}
                                <div className="relative z-10 bg-white/10 backdrop-blur-xl border border-white/20 p-8 rounded-[2rem] text-center text-white shadow-2xl max-w-xs w-full mx-6 animate-float">
                                    <div className="w-16 h-16 mx-auto bg-white/20 backdrop-blur-md rounded-full flex items-center justify-center mb-6 ring-1 ring-white/40 shadow-lg">
                                        <result.iconComponent className="w-8 h-8 text-white" />
                                    </div>
                                    <div className="text-xs font-bold tracking-[0.3em] uppercase text-white/80 mb-3">Signature Scent</div>
                                    <div className="text-5xl font-mono font-light tracking-tighter mb-4 opacity-90">#{result.id.toString().padStart(3, '0')}</div>
                                    <h2 className="text-3xl font-bold serif-font mb-2 drop-shadow-md">{result.name}</h2>
                                    <div className="w-10 h-1 bg-white/50 mx-auto mt-4 rounded-full"></div>
                                </div>
                            </div>

                            {/* Right Side */}
                            <div className="md:w-7/12 h-full overflow-y-auto bg-white custom-scrollbar p-8 md:p-16 pb-24">
                                <div className="max-w-xl mx-auto">
                                    <div className="mb-8">
                                        <span className="inline-block py-1.5 px-4 rounded-full bg-fuchsia-50 text-fuchsia-700 text-xs font-bold uppercase tracking-widest mb-4 border border-fuchsia-100">
                                            AI Analysis Complete
                                        </span>
                                        <h2 className="text-3xl font-black text-slate-900 leading-tight mb-4">
                                            Dear {userData.name}, we suggest you :
                                        </h2>
                                        <div className="text-4xl font-serif text-purple-600 mb-6">{result.name}</div>
                                        <p className="text-lg text-slate-500 font-light leading-relaxed mb-6">{result.description}</p>
                                        
                                        <div className="flex flex-wrap gap-2 mb-8">
                                            {result.moods.map((m, i) => (
                                                <span key={i} className="px-4 py-2 bg-purple-50 text-purple-700 rounded-lg text-sm font-semibold border border-purple-100 shadow-sm">
                                                    {m}
                                                </span>
                                            ))}
                                        </div>
                                    </div>

                                    <div className="mb-10">
                                        <h3 className="text-xs font-bold text-slate-400 uppercase tracking-widest mb-4">Resonance Profile</h3>
                                        <div className="space-y-4">
                                            {Object.entries(finalScores).map(([key, val]) => {
                                                const pct = val * 10;
                                                let gradient = 'linear-gradient(to right, #60a5fa, #a855f7)'; 
                                                if (pct > 60) gradient = 'linear-gradient(to right, #a855f7, #ec4899)'; 
                                                if (pct > 80) gradient = 'linear-gradient(to right, #ec4899, #ef4444)'; 

                                                return (
                                                    <div key={key}>
                                                        <div className="flex justify-between items-end mb-1">
                                                            <span className="text-xs font-bold text-slate-600">{INDEX_FULL_NAMES[key]}</span>
                                                            <span className="text-xs font-bold text-gray-500">{pct}%</span>
                                                        </div>
                                                        <div className="w-full h-2 bg-gray-100 rounded-full overflow-hidden">
                                                            <div className="h-full rounded-full transition-all duration-1000 shadow-sm" style={{ width: `${pct}%`, background: gradient }}></div>
                                                        </div>
                                                    </div>
                                                );
                                            })}
                                        </div>
                                    </div>
                                    <div className="text-center pt-8 border-t border-gray-100">
                                        <button onClick={() => { setStep(0); setAnswers({}); setIntroStep(0); setUserData({name:'', phone:''}); }} className="text-slate-400 hover:text-fuchsia-600 font-bold text-sm flex items-center justify-center gap-2 mx-auto"><Icons.RefreshCw className="w-4 h-4" /> Start New Assessment</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
